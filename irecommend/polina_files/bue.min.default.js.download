(function(g,f){BUE.popups=BUE.popups||{};BUE.popHtml='<table class="bue-popup" style="display: none;" role="dialog"><tbody class="bue-zero"><tr class="bue-zero"><td class="bue-zero"><div class="bue-popup-head clear-block"><div class="bue-popup-title"></div><button class="bue-popup-close" type="button">x</button></div><div class="bue-popup-body"><div class="bue-popup-content clear-block"></div></div></td></tr></tbody></table>';BUE.openPopup=function(b,c,a,d){return BUE.createPopup(b).open(c,a,d)};
BUE.createPopup=function(b,c,a){if(BUE.popups[b])return BUE.popups[b];var d=BUE.$html(BUE.popHtml).appendTo("body").attr("id",b),h=d.find(".bue-popup-title").html(c||""),n=d.find(".bue-popup-content").html(a||""),e=BUE.popups[b]=d[0];e.open=function(a,b,c){void 0!==a&&null!==a&&h.html(a);void 0!==b&&null!==b&&n.html(b);a=e.bue=BUE.active;a=a.buttons[a.bindex||0];c="string"==typeof c?{effect:c}:c;c=f.extend({effect:"show",speed:"normal",callback:e.onopen},c);c.onopen=c.onopen||c.callback;if(!c.offset&&
a){b=f(a).offset();var g=d.width(),q=Math.max(15,b.left-g/2+15);c.offset={left:q-Math.max(0,q+g-f(window).width()+15),top:b.top+15};a.pops=!0}d.css(c.offset);if("show"==c.effect)d.show(),c.onopen&&c.onopen.call(e);else d[c.effect](c.speed,c.onopen);e.onclose=c.onclose||!1;return e};e.close=function(a){d.stop(!0,!0)[a||"hide"]();e.onclose&&e.onclose.call(e);return e};e.closenfocus=function(){e.close().bue.focus();return e};e.onopen=function(){if("none"!=d.css("display")){var a=d.focus().find("form");
a.size()?f(a[0].elements[0]).focus():d.find("a:first").focus()}return e};d.attr("tabindex",0);d.find(".bue-popup-close").click(e.closenfocus)[0].title=Drupal.t("Close");d.keydown(function(d){if(27==d.keyCode)return e.closenfocus(),!1});d.find(".bue-popup-head").mousedown(function(a){var b=parseInt(d.css("left"))-a.pageX,h=parseInt(d.css("top"))-a.pageY,c=function(a){d.css({left:b+a.pageX,top:h+a.pageY});return!1},e=function(d){f(document).unbind("mousemove",c).unbind("mouseup",e)};f(document).mousemove(c).mouseup(e);
return!1});return e};BUE.preprocess=f.extend({popup:function(b,c){if(!b.index){var a=g.dialog=BUE.dialog=BUE.createPopup("bue-dialog"),d=function(){this.blur()},h=a.open,n=a.close;a.open=function(b,e,n){a.esp&&a.close();var f=BUE.active;f.buttonsDisabled(!0).stayClicked(!0);a.esp=f.posSelection();c(f.textArea).bind("focus.bue",d);return h(b,e,n)};a.close=function(b){if(!a.esp)return a;var h=a.bue;c(h.textArea).unbind("focus.bue",d);h.buttonsDisabled(!1).stayClicked(!1);h==BUE.active&&h.makeSelection(a.esp.start,
a.esp.end);a.esp=null;return n(b)};var e=g.quickPop=BUE.quickPop=BUE.createPopup("bue-quick-pop"),f=e.open,p=e.close,k=c(e);e.open=function(d,a){c(document).mouseup(e.close);return f(null,d,a)};e.close=function(){c(document).unbind("mouseup",e.close);return p()};k.keydown(function(d){switch(d.keyCode){case 13:setTimeout(e.closenfocus);break;case 38:case 40:var a=k.find("a"),b=a.index(document.activeElement);a.eq(b+d.keyCode-39).focus();return!1}});k.find(".bue-popup-head").css({display:"none"})}}},
BUE.preprocess)})(BUE.instance.prototype,jQuery);
(function(g,f){BUE.html=function(a,d,b){b=b||{};d=d||"";var f="<"+a,e;for(e in b)f+=null==b[e]?"":" "+e+'="'+b[e]+'"';f+=c(a)?" />"+d:">"+d+"</"+a+">";return a?f:d};BUE.objHtml=function(a){return a&&a.tag?b(a.tag,a.html,a.attributes):""};BUE.input=function(a,d,h,c){return b("input","",f.extend({type:a,name:d,value:h||null},c))};BUE.selectbox=function(a,d,h,c){h=h||{};var e="",g;for(g in h)e+=b("option",h[g],{value:g,selected:g==d?"selected":null});return b("select",e,f.extend({},c,{name:a}))};BUE.table=
function(a,d){for(var h,c="",e=0;h=a[e];e++)c+=void 0===h.data?BUE.trow(h):BUE.trow(h.data,h.attr);return b("table",c,d)};BUE.trow=function(a,d){for(var h,c="",e=0;h=a[e];e++)c+=void 0===h.data?b("td",h):b("td",h.data,h.attr);return b("tr",c,d)};BUE.regesc=function(a){return a.replace(/([\\\^\$\*\+\?\.\(\)\[\]\{\}\|\:])/g,"\\$1")};BUE.nctag=function(a){return!a||/^(img|input|hr|br|embed|param)$/.test(a)};BUE.parseHtml=function(a,d){if(!(e=a.match(new RegExp("^<("+(d||"[a-z][a-z0-9]*")+")([^>]*)>($|((?:.|[\r\n])*)</\\1>$)")))||
!e[3]&&!c(e[1]))return null;d=e[1];var b=[],f={},e;if(1<(b=e[2].split('"')).length)for(var g=0;void 0!==b[g+1];g+=2)f[b[g].replace(/\s|\=/g,"")]=b[g+1];return{tag:d,attributes:f,html:e[4]}};g.insertObj=function(a,d){if(!a||!a.tag)return this;var h=a.tag;d=f.extend({cursor:null,extend:!0,toggle:!1},d);var g,e=this.getSelection(),l=e&&d.extend&&BUE.parseHtml(e);if(g=l&&l.tag==h){if(d.toggle)return this.replaceSelection(l.html,d.cursor);a={tag:h,html:"string"!=typeof a.html||a.html==e?l.html:a.html,
attributes:f.extend(l.attributes,a.attributes)}}if(g||c(h)||a.html)return this.replaceSelection(BUE.objHtml(a),d.cursor);g=b(h,"",a.attributes);return this.tagSelection(g.substr(0,g.length-h.length-3),"</"+h+">",d.cursor)};var b=BUE.html,c=BUE.nctag})(BUE.instance.prototype,jQuery);eDefHTML=BUE.html;eDefInput=BUE.input;eDefSelectBox=BUE.selectbox;eDefTable=BUE.table;eDefRow=BUE.trow;eDefNoEnd=BUE.nctag;eDefRegEsc=BUE.regesc;eDefParseTag=BUE.parseHtml;
eDefInputText=function(g,f,b){return BUE.input("text",g,f,{size:b||null})};eDefInputSubmit=function(g,f){return BUE.input("submit",g,f)};
(function(g,f){g.prv=function(b){if(this.prvOn)return this.prvHide();b=void 0===b?!0:b;var c=this.getContent();b&&!(this.safeToPreview=this.safeToPreview||-1==c.indexOf("<"))&&(c='<div class="warning">'+Drupal.t("The preview is disabled due to previously inserted HTML code in the content. This aims to protect you from any potentially harmful code inserted by other editors or users. If you own the content, just preview an empty text to re-enable the preview.")+"</div>");return this.prvShow(BUE.autop(c))};
g.prvShow=function(b,c){var a=f(this.textArea),d=f(this.preview=this.preview||BUE.$html('<div class="preview bue-preview" style="display:none; overflow:auto"></div>').insertBefore(a)[0]);if(void 0===c||c)b='<div class="'+("comment"==this.textArea.name?"comment":"node")+'"><div class="content">'+b+"</div></div>";if(this.prvOn)return d.html(b),this;this.prvPos=this.posSelection();d.show().height(a.height()).width(a.width()).html(b);a.height(1);this.buttonsDisabled(!0,this.bindex).stayClicked(!0);this.prvOn=
!0;return this};g.prvHide=function(){if(this.prvOn){var b=f(this.preview);f(this.textArea).height(b.height());b.hide();this.buttonsDisabled(!1).stayClicked(!1);this.prvOn=!1;this.prvPos&&(this.makeSelection(this.prvPos.start,this.prvPos.end).prvPos=null)}return this};g.prvAjax=function(b,c){var a=this,d;if(a.prvOn)return a.prvHide();if(!(d=f.ajaxMarkup))return a.prvShow(Drupal.t('Preview requires <a href="http://drupal.org/project/ajax_markup">Ajax markup</a> module with proper permissions set.'));
b&&b.call&&(c=b,b=0);a.prvShow('<div class="bue-prv-loading">'+Drupal.t("Loading...")+"</div>");d(a.getContent(),b||d.getFormat(a.textArea),function(d,b,e){a.prvOn&&a.prvShow(b?d:d.replace(/\n/g,"<br />"))&&(c||Drupal.attachBehaviors)(a.preview)});return a};BUE.autop=function(b){if(""==b||!/\n|\r/.test(b))return b;var c=function(d,a,b){return d.replace(new RegExp(a,"g"),b)},a=function(d,a){return b=c(b,d,a)};b+="\n";a("<br />\\s*<br />","\n\n");a("(<(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])[^>]*>)",
"\n$1");a("(</(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])>)","$1\n\n");a("\r\n|\r","\n");a("\n\n+","\n\n");a("\n?((.|\n)+?)\n\\s*\n","<p>$1</p>\n");a("\n?((.|\n)+?)$","<p>$1</p>\n");a("<p>\\s*?</p>","");a("<p>(<div[^>]*>\\s*)","$1<p>");a("<p>([^<]+)\\s*?(</(div|address|form)[^>]*>)","<p>$1</p>$2");a("<p>\\s*(</?(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])[^>]*>)\\s*</p>",
"$1");a("<p>(<li.+?)</p>","$1");a("<p><blockquote([^>]*)>","<blockquote$1><p>");a("</blockquote></p>","</p></blockquote>");a("<p>\\s*(</?(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])[^>]*>)","$1");a("(</?(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])[^>]*>)\\s*</p>","$1");a("<(script|style)(.|\n)*?</\\1>",
function(d){return c(d,"\n","<PNL>")});a("(<br />)?\\s*\n","<br />\n");a("<PNL>","\n");a("(</?(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])[^>]*>)\\s*<br />","$1");a("<br />(\\s*</?(p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","$1");-1!=b.indexOf("<pre")&&a("(<pre(.|\n)*?>)((.|\n)*?)</pre>",function(d,a,b,e){return c(a,"\\\\(['\"\\\\])","$1")+c(c(c(e,"<p>","\n"),"</p>|<br />",""),"\\\\(['\"\\\\])",
"$1")+"</pre>"});return a("\n</p>$","</p>")}})(BUE.instance.prototype,jQuery);eDefAutoP=BUE.autop;eDefPreview=function(){BUE.active.prv()};eDefPreviewShow=function(g,f,b){g.prvShow(f,b)};eDefPreviewHide=function(g){g.prvHide()};eDefAjaxPreview=function(){BUE.active.prvAjax()};
(function(g,f){var b=g.imce=BUE.imce={};f(function(){b.url=Drupal.settings.BUE.imceURL||""});b.button=function(c,a){return b.url?'<input type="button" id="bue-imce-button" name="bue_imce_button" class="form-submit" value="'+(a||Drupal.t("Browse"))+'" onclick="BUE.imce.open(this.form.elements[\''+c+"'])\">":""};b.open=function(c){b.url&&(b.ready=b.sendto=function(){},b.target=null,f.extend(b,c.focus?{target:c,ready:b.readyDefault,sendto:b.sendtoDefault}:c),b.pop?(b.setPos(),b.ready(b.win,b.pop)):(c=
b.url+(0>b.url.indexOf("?")?"?":"&")+"app=bue|imceload@bueImceLoad|",b.pop=BUE.createPopup("bue-imce-pop",Drupal.t("File Browser"),'<iframe src="'+c+'" frameborder="0"></iframe>'),b.setPos()))};b.setPos=function(){var c=f(b.pop),a=f(window),d=f.browser.opera?window.innerHeight:a.height();b.pop.open(null,null,{offset:{left:Math.max(0,(a.width()-c.width())/2),top:a.scrollTop()+Math.max(0,(d-c.height())/2)}})};b.finish=function(c,a){b.sendto(c,a,b.pop)};b.sendtoDefault=function(c,a,d){a=b.target;var h=
a.form.elements,f={alt:c.name,width:c.width,height:c.height};a.value=c.url;for(var e in f)h["attr_"+e]&&(h["attr_"+e].value=f[e]);d.close();a.focus()};b.readyDefault=function(c,a){var d=c.imce,h=b.target&&b.target.value;h&&d.highlight(h.substr(h.lastIndexOf("/")+1));d.fileKeys&&!d.fileKeys.k27&&(d.fileKeys.k27=function(d){a.closenfocus();b.target&&b.target.focus()});f.browser.opera||f.browser.safari||f(d.FLW).focus()};window.bueImceLoad=function(c){(b.win=c).imce.setSendTo(Drupal.t("Send to editor"),
b.finish);b.ready(c,b.pop);if((f.browser.opera||f.browser.safari)&&f(b.pop).is(":visible"))f(b.win.imce.FLW).one("focus",function(){b.pop.close();b.setPos()})}})(BUE.instance.prototype,jQuery);eDefBrowseButton=function(g,f,b){return BUE.imce.button(f,b)};
(function(g,f){g.wrapLines=function(d,a,b,c){var f=this.getSelection().replace(/\r\n|\r/g,"\n"),g=BUE.regesc;if(!f)return this.tagSelection(d+a,b+c);var k,m=new RegExp("^"+g(d+a)+"((.|\n)*)"+g(b+c)+"$");return(k=f.match(m))?(m=new RegExp(g(b)+"\n"+g(a),"g"),this.replaceSelection(k[1].replace(m,"\n"))):this.replaceSelection(d+a+f.replace(/\n/g,b+"\n"+a)+b+c)};g.toggleTag=function(a,b,c){a={tag:a,html:this.getSelection(),attributes:b};return this.insertObj(a,{cursor:c,toggle:!0})};g.help=function(a){if(!this.helpHTML){for(var b,
c=[],e=0;b=this.buttons[e];e++)c[e]=[BUE.input(b.type,null,b.value||null,{"class":b.className,src:b.src||null,style:f(b).attr("style")}),b.title];this.helpHTML=BUE.table(c,{id:"bue-help","class":"bue-"+this.tplid})}this.quickPop.open(this.helpHTML,a);return this};g.tagChooser=function(a,c){var g=this;c=f.extend({wrapEach:"li",wrapAll:"ul",applyTag:!0,effect:"slideDown"},c);var e=BUE.html(c.wrapAll||"div","",{"class":"tag-chooser"}),l=b(e),p=BUE.html(c.wrapEach,"",{"class":"choice"}),k=BUE.html("a",
"",{href:"#","class":"choice-link"});f.each(a,function(a,d){var e={tag:d[0],html:d[1],attributes:d[2]};b(k).html(c.applyTag?BUE.objHtml(e):e.html).click(function(){g.insertObj(f.extend(e,{html:null}));return!1}).appendTo(l)[p?"wrap":"end"](p)});g.quickPop.open(l,c.effect);return g};g.tagDialog=function(d,g,n){for(var e=this,l=e.getSelection(),p=BUE.parseHtml(l,d)||{attributes:{}},k,m="",q=[],u=0,t=0;k=g[u];u++,t++)if(k=a(k,p,l),"hidden"==k.type)m+=c(k),t--;else for(q[t]=[BUE.html("label",k.title,
{"for":k.attributes.id}),c(k)];k.getnext&&(k=g[++u]);)q[t][1]+=c(a(k,p,l));var r=f.extend({title:Drupal.t("Tag editor - @tag",{"@tag":d.toUpperCase()}),stitle:Drupal.t("OK"),validate:!1,submit:function(a,b){return e.tgdSubmit(a,b)},effect:"show"},n);g=BUE.table(q,{"class":"bue-tgd-table"});l=BUE.html("div",BUE.input("submit","bue_tgd_submit",r.stitle,{"class":"form-submit"}));m=b(BUE.html("form",g+l+m,{name:"bue_tgd_form",id:"bue-tgd-form"}));e.dialog.open(r.title,m,n);m.submit(function(){var a;a:{for(var b,
c=0;b=this.elements[c];c++)if(f(b).is(".required")&&!b.value){a=BUE.noticeRequired(b);break a}if(b=r.validate)try{if(!b(d,this,r,e)){a=!1;break a}}catch(g){alert(g.name+": "+g.message)}e.dialog.close();a=r.submit;if(a="string"==typeof a?window[a]:a)try{a(d,this,r,e)}catch(h){alert(h.name+": "+h.message)}a=!1}return a});return e};g.tgdSubmit=function(a,b){for(var c={tag:a,html:null,attributes:{}},e,f,g=0;f=b.elements[g];g++)"attr_"==f.name.substr(0,5)&&(e=f.name.substr(5),"html"==e?c.html=f.value:
c.attributes[e]=f.value.replace(/\x22/g,"&quot;").replace(/>/g,"&gt;").replace(/</g,"&lt;")||null);return this.insertObj(c)};var b=BUE.$html,c=function(a){var b=a.prefix||"";switch(a.type){case "select":b+=BUE.selectbox(a.fname,a.value,a.options||{},a.attributes);break;case "textarea":b+=BUE.html("textarea","\n"+a.value,a.attributes);break;default:b+=BUE.input(a.type,a.fname,a.value,a.attributes)}return b+(a.suffix||"")},a=function(a,b,c){a="string"==typeof a?{name:a}:a;"html"==a.name&&(a.value="string"==
typeof b.html?b.html:c||a.value||"");a.value=Drupal.checkPlain("string"==typeof b.attributes[a.name]?b.attributes[a.name]:a.value||"");a.title="string"==typeof a.title?a.title:a.name.substr(0,1).toUpperCase()+a.name.substr(1);a.fname="attr_"+a.name;a.type=-1<a.value.indexOf("\n")?"textarea":a.type||"text";a.attributes=f.extend({name:a.fname,id:a.fname,"class":""},a.attributes);a.attributes["class"]+=" form-"+a.type;a.required&&(a.attributes["class"]+=" required",a.attributes.title=Drupal.t("This field is required."));
return a};BUE.noticeRequired=function(a){f(a).fadeOut("fast").fadeIn("fast",function(){f(this).focus()});return!1}})(BUE.instance.prototype,jQuery);eDefSelProcessLines=eDefTagLines=function(g,f,b,c){BUE.active.wrapLines(g,f,b,c)};eDefTagger=function(g,f,b){BUE.active.toggleTag(g,f,b)};eDefHelp=function(g){BUE.active.help(g)};eDefTagDialog=function(g,f,b,c,a,d){BUE.active.tagDialog(g,f,{title:b,stitle:c,submit:a,effect:d})};eDefTagInsert=function(g,f){BUE.active.tgdSubmit(g,f)};
eDefTagChooser=function(g,f,b,c,a){BUE.active.tagChooser(g,{applyTag:f,wrapEach:b,wrapAll:c,effect:a})};
