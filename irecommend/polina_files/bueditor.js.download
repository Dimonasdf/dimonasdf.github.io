(function(c){var b=window.BUE=window.BUE||{preset:{},templates:{},instances:[],preprocess:{},postprocess:{}};Drupal.behaviors.BUE=function(a){var f=Drupal.settings.BUE,d=b.templates,e=b.preset;f&&(c.each(f.templates,function(a,b){d[a]=d[a]||c.extend({},b)}),c.extend(e,f.preset),f.templates={},f.preset={});c.each(e,function(f,d){b.processTextarea(c("#"+f,a).get(0),d)});c("input:text",a).bind("keydown.bue",b.eFixEnter)};if(!Drupal.behaviors.textarea){var g=Drupal.behaviors.BUE;Drupal.behaviors.BUE=
function(){var a=Drupal.behaviors.textarea;a?(Drupal.behaviors.textarea=function(){a.apply(this,arguments);g.apply(this,arguments)},Drupal.behaviors.BUE=function(){}):g.apply(this,arguments)}}b.processTextarea=function(a,f){if(!a||!b.templates[f]||!(a=c(a).filter("textarea")[0])||"none"==a.style.display||"hidden"==a.style.visibility)return!1;if(a.bue)return a.bue;var d=new b.instance(a,f);!b.active||b.active.textArea.disabled?d.activate():d.accesskeys(!1);for(var e in b.preprocess)b.preprocess[e](d,
c);for(e in b.postprocess)b.postprocess[e](d,c);return d};b.instance=function(a,f){var d=b.instances.length,e=a.bue=b.instances[d]=this;e.index=d;e.textArea=a;e.tplid=f;e.tpl=b.templates[f];e.bindex=null;e.safeToPreview=-1==a.value.indexOf("<");e.UI=b.$html(b.theme(f).replace(/\%n/g,d)).insertBefore(a).bind("keydown.bue",b.eUIKeydown);e.buttons=c(".bue-button",e.UI).each(function(a,f){var d=f.id.split("-");c(c.extend(f,{eindex:d[1],bid:d[3],bindex:a})).bind("click.bue",b.eButtonClick)}).get();c(a).bind("focus.bue",
b.eTextareaFocus)};b.buttonClick=function(a,f){try{var d=b.instances[a].activate(),e=d.buttons[f],g=d.tpl.buttons[e.bid],n=g[1];d.bindex=f;d.dialog.close();if(g[4])g[4](d,c);else if(n){var p=n.split("%TEXT%");2==p.length?d.tagSelection(p[0],p[1]):d.replaceSelection(1==p.length?n:p.join(d.getSelection()),"end")}e.pops||e.stayClicked||d.focus()}catch(l){alert(l.name+": "+l.message)}return!1};b.theme=function(a){var f=b.templates[a]||{html:""},d="",e;if("string"==typeof f.html)return f.html;if(e=f.sprite){var g=
(new Image).src=e.url,n=e.unit,p=e.x1;c(document.body).append('<style type="text/css" media="all">.bue-'+a+" .bue-sprite-button {background-image: url("+g+"); width: "+n+"px; height: "+n+"px;}</style>")}for(var g=c.browser.mozilla&&"Shift + Alt"||(c.browser.msie||window.chrome)&&"Alt",l,q,k,r,m,h,t=0,u=0;h=f.buttons[t];t++)0==h.length?u++:(l=h[0],q=h[1],k=h[2],r=h[3],m=null,"js:"==q.substr(0,3)&&(m=h[4]=new Function("E","$",q.substr(3))),h=/\.(png|gif|jpg)$/i.test(k),"tpl:"==l.substr(0,4)?(d+=m?m(null,
c)||"":q,d+=k?'<span class="separator">'+(h?'<img src="'+f.iconpath+"/"+k+'" />':k)+"</span>":""):(h?(q="image",e?(m="sprite",k='src="'+p+'" style="background-position: -'+u*n+'px 0;"',u++):(m="image",k='src="'+f.iconpath+"/"+k+'"')):(q="button",m="text",k='value="'+k+'"'),h=l+(r?"("+r+")":""),l+=g&&r?" ("+g+" + "+r+")":"",d+='<input type="'+q+'" alt="'+h+'" title="'+l+'" accesskey="'+r+'" id="bue-%n-button-'+t+'" class="bue-button bue-'+m+"-button editor-"+m+'-button" '+k+' tabindex="'+(t?-1:0)+
'" />'));return f.html='<div class="bue-ui bue-'+a+' editor-container clear-block" id="bue-ui-%n" role="toolbar">'+d+"</div>"};b.mode=document.createElement("textarea").setSelectionRange?c.browser.opera?3:1:document.selection&&document.selection.createRange?2:0;b.text=b.processText=2>b.mode?function(a){return a.toString()}:function(a){return a.toString().replace(/\r\n/g,"\n")};b.selMake=2==b.mode?function(a,b,d){a=a.createTextRange();a.collapse();a.moveEnd("character",d);a.moveStart("character",b);
a.select()}:3==b.mode?function(a,f,d){var e=b.text(a.value),c=e.substring(0,f).split("\n").length,e=e.substring(f,d).split("\n").length;a.setSelectionRange(f+c-1,d+c+e-2)}:1==b.mode?function(a,b,d){a.setSelectionRange(b,d)}:function(a,b,d){};b.selPos=2==b.mode?function(a){a.focus();var b=document.selection.createRange(),d=b.duplicate();d.moveToElementText(a);d.setEndPoint("EndToEnd",b);var e=b.text,c=e.length,g=d.text.length-c;for((a=g-(a.value.substr(0,g).split("\r\n").length-1))&&d.moveStart("character",
a);0>d.compareEndPoints("StartToStart",b);a++)d.moveStart("character",1);for(e=a+c-(e.split("\r\n").length-1);0<d.compareEndPoints("EndToStart",b)&&(d.moveEnd("character",-1),d.text.length==c);e++);return{start:a,end:e}}:3==b.mode?function(a){var b=a.selectionStart||0,d=a.selectionEnd||0,e=a.value;a=e.substring(0,b).split("\r\n").length;e=e.substring(b,d).split("\r\n").length;return{start:b-a+1,end:d-a-e+2}}:function(a){return{start:a.selectionStart||0,end:a.selectionEnd||0}};b.eFixEnter=function(a){13==
a.keyCode&&(b.enterKeyTime=new Date)};b.eButtonClick=function(a){return!(b.enterKeyTime&&500>new Date-b.enterKeyTime)&&b.buttonClick(this.eindex,this.bindex)};b.eTextareaFocus=function(a){this.bue&&!this.bue.dialog.esp&&this.bue.activate()};b.eUIKeydown=function(a){if(37==a.keyCode||39==a.keyCode){var f,d=b.instances[this.id.split("-").pop()];if(d&&(f=d.buttons.length)){var e=document.activeElement;a=Math.max(-1,(e&&e.eindex==d.index?e.bindex:-1)+a.keyCode-38)+f;d.buttons[a%f].focus()}}};b.$html=
function(a){var b=document.createElement("div");b.innerHTML=a;return c(b.childNodes)};window.editor=window.editor||b})(jQuery);
(function(c){c.focus=function(){this.textArea.focus();return this};c.getContent=function(){return BUE.text(this.textArea.value)};c.setContent=function(b){var c=this.textArea,a=c.scrollTop;c.value=b;c.scrollTop=a;return this};c.getSelection=function(){var b=this.posSelection();return this.getContent().substring(b.start,b.end)};c.replaceSelection=function(b,c){var a=this.posSelection(),f=this.getContent();b=BUE.text(b);var d="start"==c?a.start:a.start+b.length,e="end"==c?d:a.start;this.setContent(f.substr(0,
a.start)+b+f.substr(a.end));return this.makeSelection(e,d)};c.tagSelection=function(b,c,a){var f=this.posSelection(),d=this.getContent();b=BUE.text(b);c=BUE.text(c);var e=b.length,v="start"==a?f.start+e:f.end+e;a="end"==a?v:f.start+e;this.setContent(d.substr(0,f.start)+b+d.substring(f.start,f.end)+c+d.substr(f.end));return this.makeSelection(a,v)};c.makeSelection=function(b,c){if(void 0===c||c<b)c=b;BUE.selMake(this.textArea,b,c);this.dialog.esp&&(this.dialog.esp={start:b,end:c})||this.focus();return this};
c.posSelection=function(){return this.dialog.esp||BUE.selPos(this.textArea)};c.buttonsDisabled=function(b,c){for(var a,f=0;a=this.buttons[f];f++)a.disabled=f==c?!b:b;return this};c.stayClicked=function(b,c){var a=this.buttons[void 0===c?this.bindex:c];a&&jQuery(a)[b?"addClass":"removeClass"]("stay-clicked")&&(a.stayClicked=b||!1);return this};c.accesskeys=function(b){for(var c,a=0;c=this.buttons[a];a++)c.accessKey=b?this.tpl.buttons[c.bid][3]:"";return this};c.activate=function(){var b=BUE.active||
null;if(this==b)return this;b&&b.accesskeys(!1)&&this.accesskeys(!0);return BUE.active=this};c=c.dialog=c.quickPop=BUE.dialog=BUE.quickPop={};c.open=c.close=function(){}})(BUE.instance.prototype);
